---
import { mirrors, scenarios } from '../config/mirrors';

// ç®€å•çš„ Markdown æ¸²æŸ“å‡½æ•°
function renderMarkdown(text: string): string {
  if (!text) return '';
  
  // è½¬ä¹‰ HTML
  let html = text.replace(/</g, '&lt;').replace(/>/g, '&gt;');
  
  // ä»£ç å—
  html = html.replace(/```(\w*)\n([\s\S]*?)```/g, '<pre><code>$2</code></pre>');
  
  // è¡Œå†…ä»£ç 
  html = html.replace(/`([^`]+)`/g, '<code>$1</code>');
  
  // æ ‡é¢˜
  html = html.replace(/^### (.+)$/gm, '<h3>$1</h3>');
  html = html.replace(/^## (.+)$/gm, '<h2>$1</h2>');
  
  // ç²—ä½“
  html = html.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
  
  // åˆ—è¡¨
  html = html.replace(/^- (.+)$/gm, '<li>$1</li>');
  html = html.replace(/(<li>.*<\/li>)/s, '<ul>$1</ul>');
  
  // åˆ†å‰²çº¿
  html = html.replace(/^---$/gm, '<hr>');
  
  // æ¢è¡Œ
  html = html.replace(/\n\n/g, '</p><p>');
  html = html.replace(/\n/g, '<br>');
  
  return '<p>' + html + '</p>';
}
---

<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>çˆªå­æ˜Ÿçƒ - OpenClaw å‘è¡Œç‰ˆ</title>
    <meta name="description" content="çˆªå­æ˜Ÿçƒ - æå®¢é£æ ¼çš„ OpenClaw å¤šèƒ½åŠ›é›†åˆé—¨æˆ·" />
    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }
      body {
        font-family: 'SF Mono', 'Fira Code', 'Monaco', monospace;
        background: #0a0a0f;
        color: #e0e0e0;
        min-height: 100vh;
      }
      .container { max-width: 1200px; margin: 0 auto; padding: 2rem; }
      
      /* Header */
      header {
        text-align: center;
        padding: 3rem 0;
        border-bottom: 1px solid #1a1a2e;
      }
      .logo {
        font-size: 3rem;
        margin-bottom: 0.5rem;
      }
      .tagline {
        color: #666;
        font-size: 0.9rem;
      }
      
      /* Filters */
      .filters {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
        margin: 2rem 0;
        padding: 1.5rem;
        background: #12121a;
        border: 1px solid #1a1a2e;
        border-radius: 8px;
      }
      .filter-group {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }
      .filter-group label {
        font-size: 0.75rem;
        color: #888;
        text-transform: uppercase;
      }
      .filter-group select {
        padding: 0.5rem 1rem;
        background: #0a0a0f;
        border: 1px solid #2a2a3e;
        color: #e0e0e0;
        border-radius: 4px;
        font-family: inherit;
        cursor: pointer;
      }
      .filter-group select:focus {
        outline: none;
        border-color: #00ff88;
      }
      
      /* Cards Grid */
      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
        gap: 1.5rem;
        margin-top: 2rem;
      }
      .card {
        background: #12121a;
        border: 1px solid #1a1a2e;
        border-radius: 8px;
        padding: 1.5rem;
        transition: all 0.2s;
      }
      .card:hover {
        border-color: #00ff88;
        transform: translateY(-2px);
      }
      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
      }
      .card-title {
        font-size: 1.1rem;
        color: #fff;
      }
      .card-badge {
        font-size: 0.7rem;
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        text-transform: uppercase;
      }
      .badge-windows { background: #0078d4; }
      .badge-linux { background: #e95420; }
      .badge-macos { background: #333; }
      
      .card-meta {
        display: flex;
        gap: 1rem;
        font-size: 0.8rem;
        color: #666;
        margin-bottom: 1rem;
      }
      .card-desc {
        font-size: 0.9rem;
        color: #aaa;
        margin-bottom: 1rem;
        line-height: 1.5;
      }
      .card-skills {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-bottom: 1rem;
      }
      .skill-tag {
        font-size: 0.7rem;
        padding: 0.2rem 0.5rem;
        background: #1a1a2e;
        border-radius: 3px;
        color: #00ff88;
      }
      .download-btn {
        display: block;
        width: 100%;
        padding: 0.75rem;
        background: #00ff88;
        color: #0a0a0f;
        text-align: center;
        text-decoration: none;
        border-radius: 4px;
        font-weight: bold;
        font-size: 0.9rem;
        transition: opacity 0.2s;
        margin-top: 0.75rem;
      }
      .download-btn:hover {
        opacity: 0.8;
      }
      
      /* Deploy Guide Button */
      .deploy-btn {
        display: block;
        width: 100%;
        padding: 0.75rem;
        background: #1a1a2e;
        color: #00ff88;
        text-align: center;
        text-decoration: none;
        border-radius: 4px;
        font-weight: bold;
        font-size: 0.9rem;
        transition: all 0.2s;
        border: 1px solid #00ff88;
        cursor: pointer;
      }
      .deploy-btn:hover {
        background: #00ff88;
        color: #0a0a0f;
      }
      
      /* Deploy Guide Panel */
      .deploy-panel {
        display: none;
        margin-top: 0.75rem;
        padding: 1rem;
        background: #0a0a0f;
        border: 1px solid #2a2a3e;
        border-radius: 4px;
        font-size: 0.85rem;
        line-height: 1.6;
        max-height: 400px;
        overflow-y: auto;
      }
      .deploy-panel.open {
        display: block;
      }
      .deploy-panel h2 {
        font-size: 1rem;
        color: #00ff88;
        margin-bottom: 1rem;
        border-bottom: 1px solid #2a2a3e;
        padding-bottom: 0.5rem;
      }
      .deploy-panel h3 {
        font-size: 0.9rem;
        color: #fff;
        margin: 1rem 0 0.5rem;
      }
      .deploy-panel p {
        color: #aaa;
        margin-bottom: 0.5rem;
      }
      .deploy-panel ol, .deploy-panel ul {
        color: #aaa;
        padding-left: 1.5rem;
        margin-bottom: 0.75rem;
      }
      .deploy-panel li {
        margin-bottom: 0.25rem;
      }
      .deploy-panel code {
        background: #1a1a2e;
        padding: 0.2rem 0.4rem;
        border-radius: 3px;
        font-size: 0.8rem;
        color: #f0c040;
      }
      .deploy-panel pre {
        background: #1a1a2e;
        padding: 0.75rem;
        border-radius: 4px;
        overflow-x: auto;
        margin: 0.5rem 0;
      }
      .deploy-panel pre code {
        background: none;
        padding: 0;
        color: #e0e0e0;
      }
      .deploy-panel hr {
        border: none;
        border-top: 1px solid #2a2a3e;
        margin: 1rem 0;
      }
      
      /* Footer */
      footer {
        text-align: center;
        padding: 3rem 0;
        margin-top: 3rem;
        border-top: 1px solid #1a1a2e;
        color: #444;
        font-size: 0.8rem;
      }
      footer a { color: #00ff88; }
      
      /* Empty state */
      .empty {
        text-align: center;
        padding: 4rem;
        color: #666;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <div class="logo">ğŸª çˆªå­æ˜Ÿçƒ</div>
        <p class="tagline">OpenClaw å‘è¡Œç‰ˆ | å¼€æœºå³ç”¨çš„æ™ºèƒ½åŠ©æ‰‹</p>
      </header>

      <div class="filters">
        <div class="filter-group">
          <label>æ“ä½œç³»ç»Ÿ</label>
          <select id="osFilter">
            <option value="">å…¨éƒ¨</option>
            <option value="windows">Windows</option>
            <option value="linux">Linux</option>
            <option value="macos">macOS</option>
          </select>
        </div>
        <div class="filter-group">
          <label>ç¡¬ä»¶æ¶æ„</label>
          <select id="archFilter">
            <option value="">å…¨éƒ¨</option>
            <option value="x64">x64 (Intel/AMD)</option>
            <option value="arm64">ARM64 (Apple Silicon)</option>
            <option value="arm32">ARM32 (Raspberry Pi)</option>
          </select>
        </div>
        <div class="filter-group">
          <label>ä½¿ç”¨åœºæ™¯</label>
          <select id="scenarioFilter">
            <option value="">å…¨éƒ¨</option>
            {scenarios.map(s => (
              <option value={s.id}>{s.name}</option>
            ))}
          </select>
        </div>
      </div>

      <div class="grid" id="mirrorGrid">
        {mirrors.map(mirror => (
          <div class="card" data-os={mirror.os} data-arch={mirror.arch} data-skills={mirror.skills.join(',')}>
            <div class="card-header">
              <span class="card-title">{mirror.name}</span>
              <span class={`card-badge badge-${mirror.os}`}>{mirror.os}</span>
            </div>
            <div class="card-meta">
              <span>ğŸ“¦ {mirror.version}</span>
              <span>ğŸ’¾ {mirror.size}</span>
              <span>ğŸ”§ {mirror.arch}</span>
            </div>
            <p class="card-desc">{mirror.description}</p>
            <div class="card-skills">
              {mirror.skills.map(skill => (
                <span class="skill-tag">{skill}</span>
              ))}
            </div>
            <button class="deploy-btn" onclick={`toggleDeployGuide('${mirror.id}')`}>
              ğŸ“– éƒ¨ç½²æ•™ç¨‹
            </button>
            <div class="deploy-panel" id={`deploy-${mirror.id}`}>
              <div set:html={renderMarkdown(mirror.deployGuide)} />
            </div>
            {mirror.url.includes('ä½ çš„ç½‘ç›˜åœ°å€') || mirror.url.includes('å»ºè®¾ä¸­') ? (
              <span class="download-btn" style="background: #2a2a3e; color: #666; cursor: default;">
                ğŸš§ å»ºè®¾ä¸­â€¦
              </span>
            ) : (
              <a href={mirror.url} class="download-btn" target="_blank">
                â¬‡ï¸ ä¸‹è½½é•œåƒ
              </a>
            )}
          </div>
        ))}
      </div>

      <div class="empty" id="emptyState" style="display: none;">
        æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„é•œåƒï¼Œè¯·å°è¯•å…¶ä»–ç­›é€‰æ¡ä»¶
      </div>

      <footer>
        <p>ğŸ¦ Powered by <a href="https://openclaw.ai" target="_blank">OpenClaw</a></p>
        <p>ğŸ“‚ <a href="https://github.com/hagenmagpie/openclaws" target="_blank">GitHub</a></p>
      </footer>
    </div>

    <script>
      // éƒ¨ç½²æ•™ç¨‹å±•å¼€/æŠ˜å 
      function toggleDeployGuide(id) {
        const panel = document.getElementById('deploy-' + id);
        if (panel) {
          panel.classList.toggle('open');
        }
      }

      const osFilter = document.getElementById('osFilter');
      const archFilter = document.getElementById('archFilter');
      const scenarioFilter = document.getElementById('scenarioFilter');
      const cards = document.querySelectorAll('.card');
      const emptyState = document.getElementById('emptyState');

      const scenarioSkills: Record<string, string[]> = {
        'smart-home': ['homeassistant', 'nodes'],
        'office': ['feishu-doc', 'feishu-wiki', 'feishu-drive'],
        'automation': ['cron', 'weather', 'memory'],
        'iot': ['nodes', 'homeassistant', 'weather'],
        'monitor': ['nodes', 'camera'],
      };

      function filterCards() {
        const os = osFilter.value;
        const arch = archFilter.value;
        const scenario = scenarioFilter.value;
        
        let visibleCount = 0;
        
        cards.forEach(card => {
          const cardOs = card.getAttribute('data-os');
          const cardArch = card.getAttribute('data-arch');
          const cardSkills = card.getAttribute('data-skills') || '';
          
          let show = true;
          
          if (os && cardOs !== os) show = false;
          if (arch && cardArch !== arch) show = false;
          
          if (scenario) {
            const neededSkills = scenarioSkills[scenario] || [];
            const hasSkill = neededSkills.some(s => cardSkills.includes(s));
            if (!hasSkill) show = false;
          }
          
          (card as HTMLElement).style.display = show ? 'block' : 'none';
          if (show) visibleCount++;
        });
        
        emptyState.style.display = visibleCount === 0 ? 'block' : 'none';
      }

      osFilter.addEventListener('change', filterCards);
      archFilter.addEventListener('change', filterCards);
      scenarioFilter.addEventListener('change', filterCards);
    </script>
  </body>
</html>
