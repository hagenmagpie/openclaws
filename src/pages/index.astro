---
import { mirrors, scenarios } from '../config/mirrors';

// ç®€å•çš„ Markdown æ¸²æŸ“å‡½æ•°
function renderMarkdown(text: string): string {
  if (!text) return '';
  
  // è½¬ä¹‰ HTML
  let html = text.replace(/</g, '&lt;').replace(/>/g, '&gt;');
  
  // ä»£ç å—
  html = html.replace(/```(\w*)\n([\s\S]*?)```/g, '<pre><code>$2</code></pre>');
  
  // è¡Œå†…ä»£ç 
  html = html.replace(/`([^`]+)`/g, '<code>$1</code>');
  
  // æ ‡é¢˜
  html = html.replace(/^### (.+)$/gm, '<h3>$1</h3>');
  html = html.replace(/^## (.+)$/gm, '<h2>$1</h2>');
  
  // ç²—ä½“
  html = html.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
  
  // åˆ—è¡¨
  html = html.replace(/^- (.+)$/gm, '<li>$1</li>');
  html = html.replace(/(<li>.*<\/li>)/s, '<ul>$1</ul>');
  
  // åˆ†å‰²çº¿
  html = html.replace(/^---$/gm, '<hr>');
  
  // æ¢è¡Œ
  html = html.replace(/\n\n/g, '</p><p>');
  html = html.replace(/\n/g, '<br>');
  
  return '<p>' + html + '</p>';
}
---

<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>çˆªå­æ˜Ÿçƒ - OpenClaw å‘è¡Œç‰ˆ</title>
    <meta name="description" content="çˆªå­æ˜Ÿçƒ - æå®¢é£æ ¼çš„ OpenClaw å¤šèƒ½åŠ›é›†åˆé—¨æˆ·" />
    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }
      body {
        font-family: 'SF Mono', 'Fira Code', 'Monaco', monospace;
        background: #0a0a0f;
        color: #e0e0e0;
        min-height: 100vh;
      }
      .container { max-width: 1200px; margin: 0 auto; padding: 2rem; }
      
      /* Header */
      header {
        text-align: center;
        padding: 3rem 0;
        border-bottom: 1px solid #1a1a2e;
      }
      .logo {
        font-size: 3rem;
        margin-bottom: 0.5rem;
      }
      .tagline {
        color: #666;
        font-size: 0.9rem;
      }
      
      /* Filters */
      .filters {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
        margin: 2rem 0;
        padding: 1.5rem;
        background: #12121a;
        border: 1px solid #1a1a2e;
        border-radius: 8px;
      }
      .filter-group {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }
      .filter-group label {
        font-size: 0.75rem;
        color: #888;
        text-transform: uppercase;
      }
      .filter-group select {
        padding: 0.5rem 1rem;
        background: #0a0a0f;
        border: 1px solid #2a2a3e;
        color: #e0e0e0;
        border-radius: 4px;
        font-family: inherit;
        cursor: pointer;
      }
      .filter-group select:focus {
        outline: none;
        border-color: #00ff88;
      }
      
      /* Cards Grid */
      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
        gap: 1.5rem;
        margin-top: 2rem;
      }
      .card {
        background: #12121a;
        border: 1px solid #1a1a2e;
        border-radius: 8px;
        padding: 1.5rem;
        transition: all 0.2s;
      }
      .card:hover {
        border-color: #00ff88;
        transform: translateY(-2px);
      }
      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
      }
      .card-title {
        font-size: 1.1rem;
        color: #fff;
      }
      .card-badge {
        font-size: 0.7rem;
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        text-transform: uppercase;
      }
      .badge-windows { background: #0078d4; }
      .badge-linux { background: #e95420; }
      .badge-macos { background: #333; }
      
      .card-meta {
        display: flex;
        gap: 1rem;
        font-size: 0.8rem;
        color: #666;
        margin-bottom: 1rem;
      }
      .card-desc {
        font-size: 0.9rem;
        color: #aaa;
        margin-bottom: 1rem;
        line-height: 1.5;
      }
      .card-skills {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-bottom: 1rem;
      }
      .skill-tag {
        font-size: 0.7rem;
        padding: 0.2rem 0.5rem;
        background: #1a1a2e;
        border-radius: 3px;
        color: #00ff88;
      }
      .download-btn {
        display: block;
        width: 100%;
        padding: 0.75rem;
        background: #00ff88;
        color: #0a0a0f;
        text-align: center;
        text-decoration: none;
        border-radius: 4px;
        font-weight: bold;
        font-size: 0.9rem;
        transition: opacity 0.2s;
      }
      .download-btn:hover {
        opacity: 0.8;
      }
      
      /* Footer */
      footer {
        text-align: center;
        padding: 3rem 0;
        margin-top: 3rem;
        border-top: 1px solid #1a1a2e;
        color: #444;
        font-size: 0.8rem;
      }
      footer a { color: #00ff88; }
      
      /* Empty state */
      .empty {
        text-align: center;
        padding: 4rem;
        color: #666;
      }
      
      /* AI News Section */
      .news-section {
        margin: 2rem 0;
      }
      .news-header {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 1.2rem;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid;
      }
      .news-header.latest {
        border-color: #00bfff;
        color: #00bfff;
      }
      .news-header.hot {
        border-color: #ff6b6b;
        color: #ff6b6b;
      }
      .news-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
      }
      .news-card {
        background: #12121a;
        border: 1px solid #1a1a2e;
        border-radius: 8px;
        padding: 1rem;
        transition: all 0.2s;
        text-decoration: none;
        display: block;
      }
      .news-card:hover {
        transform: translateY(-2px);
      }
      .news-card.latest:hover {
        border-color: #00bfff;
        box-shadow: 0 4px 12px rgba(0, 191, 255, 0.15);
      }
      .news-card.hot:hover {
        border-color: #ff6b6b;
        box-shadow: 0 4px 12px rgba(255, 107, 107, 0.15);
      }
      .news-title {
        font-size: 0.95rem;
        color: #e0e0e0;
        margin-bottom: 0.5rem;
        line-height: 1.4;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }
      .news-meta {
        font-size: 0.75rem;
        color: #666;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .news-source {
        background: #1a1a2e;
        padding: 0.2rem 0.5rem;
        border-radius: 3px;
      }
      .news-time {
        color: #888;
      }
      .news-loading {
        text-align: center;
        padding: 2rem;
        color: #666;
      }
      .news-error {
        text-align: center;
        padding: 2rem;
        color: #ff6b6b;
      }
      .news-refresh {
        display: inline-block;
        margin-left: auto;
        padding: 0.3rem 0.8rem;
        font-size: 0.75rem;
        background: transparent;
        border: 1px solid currentColor;
        border-radius: 4px;
        color: inherit;
        cursor: pointer;
        transition: all 0.2s;
      }
      .news-refresh:hover {
        background: rgba(255,255,255,0.1);
      }
      .news-section-title {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin: 2rem 0 1rem;
      }
      .news-section-title h2 {
        font-size: 1.1rem;
        margin: 0;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <img src="/logo.svg" alt="openclaws" class="logo-img" style="width: 320px; height: auto;" />
        <p class="tagline">å¼€æœºå³ç”¨çš„æ™ºèƒ½åŠ©æ‰‹ Â· æŒ‰éœ€é€‰æ‹© Â· å¿«é€Ÿéƒ¨ç½²</p>
      </header>

      <!-- AI News Section -->
      <div class="news-section">
        <div class="news-section-title">
          <h2>ğŸ¤– AI èµ„è®¯</h2>
          <button class="news-refresh" onclick="loadNews()">ğŸ”„ åˆ·æ–°</button>
        </div>
        
        <!-- Latest AI News -->
        <div class="news-header latest">
          <span>ğŸ“° æœ€æ–° AI æ¶ˆæ¯</span>
          <span style="font-size: 0.8rem; color: #888;">ä»Šæ—¥æ›´æ–°</span>
        </div>
        <div class="news-grid" id="latestNews">
          <div class="news-loading">åŠ è½½ä¸­...</div>
        </div>
        
        <!-- Hot AI News -->
        <div class="news-header hot">
          <span>ğŸ”¥ æœ€çƒ­ AI æ¶ˆæ¯</span>
          <span style="font-size: 0.8rem; color: #888;">çƒ­é—¨æ’è¡Œ</span>
        </div>
        <div class="news-grid" id="hotNews">
          <div class="news-loading">åŠ è½½ä¸­...</div>
        </div>
      </div>

      <div class="filters">
        <div class="filter-group">
          <label>æ“ä½œç³»ç»Ÿ</label>
          <select id="osFilter">
            <option value="">å…¨éƒ¨</option>
            <option value="windows">Windows</option>
            <option value="linux">Linux</option>
            <option value="macos">macOS</option>
          </select>
        </div>
        <div class="filter-group">
          <label>ç¡¬ä»¶æ¶æ„</label>
          <select id="archFilter">
            <option value="">å…¨éƒ¨</option>
            <option value="x64">x64 (Intel/AMD)</option>
            <option value="arm64">ARM64 (Apple Silicon)</option>
            <option value="arm32">ARM32 (Raspberry Pi)</option>
          </select>
        </div>
        <div class="filter-group">
          <label>ä½¿ç”¨åœºæ™¯</label>
          <select id="scenarioFilter">
            <option value="">å…¨éƒ¨</option>
            {scenarios.map(s => (
              <option value={s.id}>{s.name}</option>
            ))}
          </select>
        </div>
      </div>

      <div class="grid" id="mirrorGrid">
        {mirrors.map(mirror => (
          <div class="card" data-os={mirror.os} data-arch={mirror.arch} data-skills={mirror.skills.join(',')}>
            <div class="card-header">
              <span class="card-title">{mirror.name}</span>
              <span class={`card-badge badge-${mirror.os}`}>{mirror.os}</span>
            </div>
            <div class="card-meta">
              <span>ğŸ“¦ {mirror.version}</span>
              <span>ğŸ’¾ {mirror.size}</span>
              <span>ğŸ”§ {mirror.arch}</span>
            </div>
            <p class="card-desc">{mirror.description}</p>
            <div class="card-skills">
              {mirror.skills.map(skill => (
                <span class="skill-tag">{skill}</span>
              ))}
            </div>
            {mirror.url.includes('ä½ çš„ç½‘ç›˜åœ°å€') || mirror.url.includes('å»ºè®¾ä¸­') ? (
              <span class="download-btn" style="background: #2a2a3e; color: #666; cursor: default;">
                ğŸš§ å»ºè®¾ä¸­â€¦
              </span>
            ) : (
              <a href={mirror.url} class="download-btn" target="_blank">
                â¬‡ï¸ ä¸‹è½½é•œåƒ
              </a>
            )}
          </div>
        ))}
      </div>

      <div class="empty" id="emptyState" style="display: none;">
        æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„é•œåƒï¼Œè¯·å°è¯•å…¶ä»–ç­›é€‰æ¡ä»¶
      </div>

      <footer>
        <p>ğŸ¦ Powered by <a href="https://openclaw.ai" target="_blank">OpenClaw</a></p>
        <p>ğŸ“‚ <a href="https://github.com/hagenmagpie/openclaws" target="_blank">GitHub</a></p>
      </footer>
    </div>

    <script>
      const osFilter = document.getElementById('osFilter');
      const archFilter = document.getElementById('archFilter');
      const scenarioFilter = document.getElementById('scenarioFilter');
      const cards = document.querySelectorAll('.card');
      const emptyState = document.getElementById('emptyState');

      const scenarioSkills: Record<string, string[]> = {
        'smart-home': ['homeassistant', 'nodes'],
        'office': ['feishu-doc', 'feishu-wiki', 'feishu-drive'],
        'automation': ['cron', 'weather', 'memory'],
        'iot': ['nodes', 'homeassistant', 'weather'],
        'monitor': ['nodes', 'camera'],
      };

      function filterCards() {
        const os = osFilter.value;
        const arch = archFilter.value;
        const scenario = scenarioFilter.value;
        
        let visibleCount = 0;
        
        cards.forEach(card => {
          const cardOs = card.getAttribute('data-os');
          const cardArch = card.getAttribute('data-arch');
          const cardSkills = card.getAttribute('data-skills') || '';
          
          let show = true;
          
          if (os && cardOs !== os) show = false;
          if (arch && cardArch !== arch) show = false;
          
          if (scenario) {
            const neededSkills = scenarioSkills[scenario] || [];
            const hasSkill = neededSkills.some(s => cardSkills.includes(s));
            if (!hasSkill) show = false;
          }
          
          (card as HTMLElement).style.display = show ? 'block' : 'none';
          if (show) visibleCount++;
        });
        
        emptyState.style.display = visibleCount === 0 ? 'block' : 'none';
      }

      osFilter.addEventListener('change', filterCards);
      archFilter.addEventListener('change', filterCards);
      scenarioFilter.addEventListener('change', filterCards);

      // AI News Fetching
      async function fetchAINews() {
        const news = { latest: [], hot: [] };
        
        try {
          // Fetch from Hacker News (AI related)
          const hnResponse = await fetch('https://hacker-news.firebaseio.com/v0/topstories.json');
          const hnIds = await hnResponse.json();
          
          // Get top 30 stories and filter for AI-related
          const hnPromises = hnIds.slice(0, 30).map(async (id) => {
            const storyRes = await fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`);
            return storyRes.json();
          });
          
          const hnStories = await Promise.all(hnPromises);
          
          // Filter AI-related stories
          const aiKeywords = ['AI', 'artificial intelligence', 'OpenAI', 'GPT', 'Claude', 'Gemini', 'LLM', 'machine learning', 'deep learning', 'neural', 'ChatGPT', 'Anthropic', 'Google AI', 'Meta AI', 'Tesla', 'è‡ªåŠ¨é©¾é©¶', 'å¤§æ¨¡å‹', 'äººå·¥æ™ºèƒ½'];
          
          const aiStories = hnStories.filter((story) => {
            if (!story || !story.title) return false;
            const titleLower = story.title.toLowerCase();
            return aiKeywords.some((k) => titleLower.includes(k.toLowerCase()));
          });
          
          // Split into latest and hot
          news.latest = aiStories.slice(0, 10).map((story) => ({
            title: story.title,
            url: story.url || `https://news.ycombinator.com/item?id=${story.id}`,
            source: 'Hacker News',
            time: story.time ? new Date(story.time * 1000) : new Date(),
            score: story.score || 0
          }));
          
          // Hot = top scored AI stories
          const hotStories = [...aiStories].sort((a, b) => (b.score || 0) - (a.score || 0));
          news.hot = hotStories.slice(0, 10).map((story) => ({
            title: story.title,
            url: story.url || `https://news.ycombinator.com/item?id=${story.id}`,
            source: 'Hacker News',
            time: story.time ? new Date(story.time * 1000) : new Date(),
            score: story.score || 0
          }));
          
        } catch (error) {
          console.error('Failed to fetch news:', error);
        }
        
        return news;
      }

      function timeAgo(date) {
        const now = new Date();
        const diff = now.getTime() - date.getTime();
        const hours = Math.floor(diff / (1000 * 60 * 60));
        const days = Math.floor(hours / 24);
        
        if (days > 0) return `${days}å¤©å‰`;
        if (hours > 0) return `${hours}å°æ—¶å‰`;
        return 'åˆšåˆš';
      }

      function renderNewsCard(item, type) {
        return `
          <a href="${item.url}" target="_blank" class="news-card ${type}">
            <div class="news-title">${item.title}</div>
            <div class="news-meta">
              <span class="news-source">${item.source}</span>
              <span class="news-time">${timeAgo(item.time)}${item.score ? ' Â· ' + item.score + ' â–²' : ''}</span>
            </div>
          </a>
        `;
      }

      async function loadNews() {
        const latestContainer = document.getElementById('latestNews');
        const hotContainer = document.getElementById('hotNews');
        
        if (latestContainer) latestContainer.innerHTML = '<div class="news-loading">åŠ è½½ä¸­...</div>';
        if (hotContainer) hotContainer.innerHTML = '<div class="news-loading">åŠ è½½ä¸­...</div>';
        
        const news = await fetchAINews();
        
        if (latestContainer) {
          if (news.latest.length > 0) {
            latestContainer.innerHTML = news.latest.map((item) => renderNewsCard(item, 'latest')).join('');
          } else {
            latestContainer.innerHTML = '<div class="news-error">æš‚æ— æœ€æ–°èµ„è®¯</div>';
          }
        }
        
        if (hotContainer) {
          if (news.hot.length > 0) {
            hotContainer.innerHTML = news.hot.map((item) => renderNewsCard(item, 'hot')).join('');
          } else {
            hotContainer.innerHTML = '<div class="news-error">æš‚æ— çƒ­é—¨èµ„è®¯</div>';
          }
        }
      }

      // Load news on page load
      loadNews();
    </script>
  </body>
</html>
