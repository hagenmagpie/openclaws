---
import { mirrors, scenarios } from '../config/mirrors';

// ç®€å•çš„ Markdown æ¸²æŸ“å‡½æ•°
function renderMarkdown(text: string): string {
  if (!text) return '';
  
  // è½¬ä¹‰ HTML
  let html = text.replace(/</g, '&lt;').replace(/>/g, '&gt;');
  
  // ä»£ç å—
  html = html.replace(/```(\w*)\n([\s\S]*?)```/g, '<pre><code>$2</code></pre>');
  
  // è¡Œå†…ä»£ç 
  html = html.replace(/`([^`]+)`/g, '<code>$1</code>');
  
  // æ ‡é¢˜
  html = html.replace(/^### (.+)$/gm, '<h3>$1</h3>');
  html = html.replace(/^## (.+)$/gm, '<h2>$1</h2>');
  
  // ç²—ä½“
  html = html.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
  
  // åˆ—è¡¨
  html = html.replace(/^- (.+)$/gm, '<li>$1</li>');
  html = html.replace(/(<li>.*<\/li>)/s, '<ul>$1</ul>');
  
  // åˆ†å‰²çº¿
  html = html.replace(/^---$/gm, '<hr>');
  
  // æ¢è¡Œ
  html = html.replace(/\n\n/g, '</p><p>');
  html = html.replace(/\n/g, '<br>');
  
  return '<p>' + html + '</p>';
}
---

<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>çˆªå­æ˜Ÿçƒ - OpenClaw å‘è¡Œç‰ˆ</title>
    <meta name="description" content="çˆªå­æ˜Ÿçƒ - æå®¢é£æ ¼çš„ OpenClaw å¤šèƒ½åŠ›é›†åˆé—¨æˆ·" />
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
      
      * { margin: 0; padding: 0; box-sizing: border-box; image-rendering: pixelated; }
      body {
        font-family: 'Press Start 2P', 'Courier New', monospace;
        background: #0a0a0f;
        color: #e0e0e0;
        min-height: 100vh;
        image-rendering: pixelated;
      }
      .container { max-width: 1200px; margin: 0 auto; padding: 1.5rem; }
      
      /* Header - Pixel Style */
      header {
        text-align: center;
        padding: 2rem 0;
        border-bottom: 4px solid #1a1a2e;
        image-rendering: pixelated;
      }
      .logo-img {
        width: 280px;
        height: auto;
        image-rendering: pixelated;
      }
      .tagline {
        color: #00ff88;
        font-size: 0.5rem;
        margin-top: 1rem;
        text-shadow: 2px 2px 0 #006644;
      }
      
      /* Filters - Pixel Style */
      .filters {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
        margin: 1.5rem 0;
        padding: 1rem;
        background: #12121a;
        border: 4px solid #1a1a2e;
      }
      .filter-group {
        display: flex;
        flex-direction: column;
        gap: 0.3rem;
      }
      .filter-group label {
        font-size: 0.4rem;
        color: #00ff88;
        text-transform: uppercase;
      }
      .filter-group select {
        padding: 0.5rem;
        background: #0a0a0f;
        border: 2px solid #2a2a3e;
        color: #00ff88;
        font-family: inherit;
        cursor: pointer;
        font-size: 0.5rem;
      }
      .filter-group select:focus {
        outline: none;
        border-color: #00ff88;
      }
      
      /* Cards Grid - Pixel Style */
      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 1rem;
        margin-top: 1.5rem;
      }
      .card {
        background: #12121a;
        border: 4px solid #1a1a2e;
        padding: 1rem;
        transition: all 0.1s;
      }
      .card:hover {
        border-color: #00ff88;
        transform: translate(-2px, -2px);
        box-shadow: 4px 4px 0 #00ff88;
      }
      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.8rem;
        border-bottom: 2px solid #1a1a2e;
        padding-bottom: 0.5rem;
      }
      .card-title {
        font-size: 0.6rem;
        color: #fff;
      }
      .card-badge {
        font-size: 0.4rem;
        padding: 0.2rem 0.4rem;
        border: 2px solid;
      }
      .badge-windows { border-color: #0078d4; color: #0078d4; }
      .badge-linux { border-color: #e95420; color: #e95420; }
      .badge-macos { border-color: #888; color: #888; }
      
      .card-meta {
        display: flex;
        gap: 0.8rem;
        font-size: 0.4rem;
        color: #00ccff;
        margin-bottom: 0.8rem;
      }
      .card-desc {
        font-size: 0.45rem;
        color: #aaa;
        margin-bottom: 0.8rem;
        line-height: 1.6;
      }
      .card-skills {
        display: flex;
        flex-wrap: wrap;
        gap: 0.3rem;
        margin-bottom: 0.8rem;
      }
      .skill-tag {
        font-size: 0.35rem;
        padding: 0.2rem 0.4rem;
        border: 2px solid #00ff88;
        color: #00ff88;
      }
      .download-btn {
        display: block;
        width: 100%;
        padding: 0.6rem;
        background: #00ff88;
        color: #0a0a0f;
        text-align: center;
        text-decoration: none;
        font-size: 0.5rem;
        font-weight: bold;
        border: none;
        cursor: pointer;
      }
      .download-btn:hover {
        background: #00cc66;
        box-shadow: 0 0 10px #00ff88;
      }
      
      /* Footer - Pixel Style */
      footer {
        text-align: center;
        padding: 2rem 0;
        margin-top: 2rem;
        border-top: 4px solid #1a1a2e;
        color: #666;
        font-size: 0.4rem;
      }
      footer a { color: #00ff88; text-decoration: none; }
      footer a:hover { color: #00ffcc; }
      
      /* Empty state */
      .empty {
        text-align: center;
        padding: 3rem;
        color: #666;
        font-size: 0.5rem;
        border: 4px solid #1a1a2e;
        background: #12121a;
      }
      
      /* News Section - Pixel Style */
      .news-section {
        margin: 1.5rem 0;
      }
      .news-updated {
        font-size: 0.35rem;
        color: #00ccff;
      }
      .news-header {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.6rem;
        margin-bottom: 0.8rem;
        padding-bottom: 0.3rem;
        border-bottom: 4px solid;
        margin-top: 1rem;
      }
      .news-header.latest {
        border-color: #00bfff;
        color: #00bfff;
      }
      .news-header.hot {
        border-color: #ff6b6b;
        color: #ff6b6b;
      }
      .news-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
        gap: 0.8rem;
        margin-bottom: 1rem;
      }
      .news-card {
        background: #12121a;
        border: 4px solid #1a1a2e;
        padding: 0.8rem;
        transition: all 0.1s;
        text-decoration: none;
        display: block;
      }
      .news-card:hover {
        transform: translate(-2px, -2px);
      }
      .news-card.latest:hover {
        border-color: #00bfff;
        box-shadow: 4px 4px 0 #00bfff;
      }
      .news-card.hot:hover {
        border-color: #ff6b6b;
        box-shadow: 4px 4px 0 #ff6b6b;
      }
      .news-title {
        font-size: 0.45rem;
        color: #e0e0e0;
        margin-bottom: 0.5rem;
        line-height: 1.5;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }
      .news-meta {
        font-size: 0.35rem;
        color: #666;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .news-source {
        border: 2px solid #1a1a2e;
        padding: 0.2rem 0.4rem;
        color: #00ff88;
      }
      .news-time {
        color: #00ccff;
      }
      .news-loading {
        text-align: center;
        padding: 1.5rem;
        color: #666;
        font-size: 0.4rem;
      }
      .news-section-title {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin: 1.5rem 0 0.8rem;
      }
      .news-section-title h2 {
        font-size: 0.6rem;
        margin: 0;
        color: #00ff88;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <img src="/logo-pixel.svg" alt="openclaws" class="logo-img" />
        <p class="tagline">å¼€æœºå³ç”¨çš„æ™ºèƒ½åŠ©æ‰‹ Â· æŒ‰éœ€é€‰æ‹© Â· å¿«é€Ÿéƒ¨ç½²</p>
      </header>

      <!-- AI News Section -->
      <div class="news-section">
        <div class="news-section-title">
          <h2>ğŸ¤– AI èµ„è®¯</h2>
          <span id="updatedTime" class="news-updated">æ›´æ–°æ—¶é—´: --</span>
        </div>
        
        <!-- Latest AI News -->
        <div class="news-header latest">
          <span>ğŸ“° æœ€æ–° AI æ¶ˆæ¯</span>
          <span style="font-size: 0.8rem; color: #888;">ä»Šæ—¥æ›´æ–°</span>
        </div>
        <div class="news-grid" id="latestNews">
          <div class="news-loading">åŠ è½½ä¸­...</div>
        </div>
        
        <!-- Hot AI News -->
        <div class="news-header hot">
          <span>ğŸ”¥ æœ€çƒ­ AI æ¶ˆæ¯</span>
          <span style="font-size: 0.8rem; color: #888;">çƒ­é—¨æ’è¡Œ</span>
        </div>
        <div class="news-grid" id="hotNews">
          <div class="news-loading">åŠ è½½ä¸­...</div>
        </div>
      </div>

      <div class="filters">
        <div class="filter-group">
          <label>æ“ä½œç³»ç»Ÿ</label>
          <select id="osFilter">
            <option value="">å…¨éƒ¨</option>
            <option value="windows">Windows</option>
            <option value="linux">Linux</option>
            <option value="macos">macOS</option>
          </select>
        </div>
        <div class="filter-group">
          <label>ç¡¬ä»¶æ¶æ„</label>
          <select id="archFilter">
            <option value="">å…¨éƒ¨</option>
            <option value="x64">x64 (Intel/AMD)</option>
            <option value="arm64">ARM64 (Apple Silicon)</option>
            <option value="arm32">ARM32 (Raspberry Pi)</option>
          </select>
        </div>
        <div class="filter-group">
          <label>ä½¿ç”¨åœºæ™¯</label>
          <select id="scenarioFilter">
            <option value="">å…¨éƒ¨</option>
            {scenarios.map(s => (
              <option value={s.id}>{s.name}</option>
            ))}
          </select>
        </div>
      </div>

      <div class="grid" id="mirrorGrid">
        {mirrors.map(mirror => (
          <div class="card" data-os={mirror.os} data-arch={mirror.arch} data-skills={mirror.skills.join(',')}>
            <div class="card-header">
              <span class="card-title">{mirror.name}</span>
              <span class={`card-badge badge-${mirror.os}`}>{mirror.os}</span>
            </div>
            <div class="card-meta">
              <span>ğŸ“¦ {mirror.version}</span>
              <span>ğŸ’¾ {mirror.size}</span>
              <span>ğŸ”§ {mirror.arch}</span>
            </div>
            <p class="card-desc">{mirror.description}</p>
            <div class="card-skills">
              {mirror.skills.map(skill => (
                <span class="skill-tag">{skill}</span>
              ))}
            </div>
            {mirror.url.includes('ä½ çš„ç½‘ç›˜åœ°å€') || mirror.url.includes('å»ºè®¾ä¸­') ? (
              <span class="download-btn" style="background: #2a2a3e; color: #666; cursor: default;">
                ğŸš§ å»ºè®¾ä¸­â€¦
              </span>
            ) : (
              <a href={mirror.url} class="download-btn" target="_blank">
                â¬‡ï¸ ä¸‹è½½é•œåƒ
              </a>
            )}
          </div>
        ))}
      </div>

      <div class="empty" id="emptyState" style="display: none;">
        æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„é•œåƒï¼Œè¯·å°è¯•å…¶ä»–ç­›é€‰æ¡ä»¶
      </div>

      <footer>
        <p>ğŸ¦ Powered by <a href="https://openclaw.ai" target="_blank">OpenClaw</a></p>
        <p>ğŸ“‚ <a href="https://github.com/hagenmagpie/openclaws" target="_blank">GitHub</a></p>
      </footer>
    </div>

    <script>
      const osFilter = document.getElementById('osFilter');
      const archFilter = document.getElementById('archFilter');
      const scenarioFilter = document.getElementById('scenarioFilter');
      const cards = document.querySelectorAll('.card');
      const emptyState = document.getElementById('emptyState');

      const scenarioSkills: Record<string, string[]> = {
        'smart-home': ['homeassistant', 'nodes'],
        'office': ['feishu-doc', 'feishu-wiki', 'feishu-drive'],
        'automation': ['cron', 'weather', 'memory'],
        'iot': ['nodes', 'homeassistant', 'weather'],
        'monitor': ['nodes', 'camera'],
      };

      function filterCards() {
        const os = osFilter.value;
        const arch = archFilter.value;
        const scenario = scenarioFilter.value;
        
        let visibleCount = 0;
        
        cards.forEach(card => {
          const cardOs = card.getAttribute('data-os');
          const cardArch = card.getAttribute('data-arch');
          const cardSkills = card.getAttribute('data-skills') || '';
          
          let show = true;
          
          if (os && cardOs !== os) show = false;
          if (arch && cardArch !== arch) show = false;
          
          if (scenario) {
            const neededSkills = scenarioSkills[scenario] || [];
            const hasSkill = neededSkills.some(s => cardSkills.includes(s));
            if (!hasSkill) show = false;
          }
          
          (card as HTMLElement).style.display = show ? 'block' : 'none';
          if (show) visibleCount++;
        });
        
        emptyState.style.display = visibleCount === 0 ? 'block' : 'none';
      }

      osFilter.addEventListener('change', filterCards);
      archFilter.addEventListener('change', filterCards);
      scenarioFilter.addEventListener('change', filterCards);

      // AI News Loading (from static JSON)
      async function fetchAINews() {
        const news = { latest: [], hot: [], updated: null };
        
        try {
          const response = await fetch('/openclaws/data/ai-news.json');
          const data = await response.json();
          news.latest = data.latest || [];
          news.hot = data.hot || [];
          news.updated = data.updated;
        } catch (error) {
          console.error('Failed to load news:', error);
        }
        
        return news;
      }

      function formatDate(isoString) {
        if (!isoString) return '';
        const date = new Date(isoString);
        return date.toLocaleString('zh-CN', { 
          month: 'numeric', 
          day: 'numeric', 
          hour: '2-digit', 
          minute: '2-digit' 
        });
      }

      function formatNewsTime(timestamp) {
        const date = new Date(timestamp);
        return date.toLocaleString('zh-CN', { 
          month: 'numeric', 
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        });
      }

      function renderNewsCard(item, type) {
        return `
          <a href="${item.url}" target="_blank" class="news-card ${type}">
            <div class="news-title">${item.title}</div>
            <div class="news-meta">
              <span class="news-source">${item.source}</span>
              <span class="news-time">${formatNewsTime(item.time)}${item.score ? ' Â· ' + item.score + ' â–²' : ''}</span>
            </div>
          </a>
        `;
      }

      async function loadNews() {
        const latestContainer = document.getElementById('latestNews');
        const hotContainer = document.getElementById('hotNews');
        const updatedTime = document.getElementById('updatedTime');
        
        if (latestContainer) latestContainer.innerHTML = '<div class="news-loading">åŠ è½½ä¸­...</div>';
        if (hotContainer) hotContainer.innerHTML = '<div class="news-loading">åŠ è½½ä¸­...</div>';
        
        const news = await fetchAINews();
        
        // Update timestamp
        if (updatedTime && news.updated) {
          updatedTime.textContent = 'æ›´æ–°æ—¶é—´: ' + formatDate(news.updated);
        }
        
        if (latestContainer) {
          if (news.latest.length > 0) {
            latestContainer.innerHTML = news.latest.slice(0, 10).map((item) => renderNewsCard(item, 'latest')).join('');
          } else {
            latestContainer.innerHTML = '<div class="news-error">æš‚æ— æœ€æ–°èµ„è®¯</div>';
          }
        }
        
        if (hotContainer) {
          if (news.hot.length > 0) {
            hotContainer.innerHTML = news.hot.slice(0, 10).map((item) => renderNewsCard(item, 'hot')).join('');
          } else {
            hotContainer.innerHTML = '<div class="news-error">æš‚æ— çƒ­é—¨èµ„è®¯</div>';
          }
        }
      }

      // Load news on page load
      loadNews();
    </script>
  </body>
</html>
